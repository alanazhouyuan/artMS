---
title: "artMS:Analytical R Tools for Mass Spectrometry"
author: "David Jimenez-Morales"
date: 2018-09-05
# output: rmarkdown::html_vignette
# vignette: >
#   %\VignetteIndexEntry{Vignette Title}
#   %\VignetteEngine{knitr::rmarkdown}
#   %\VignetteEncoding{UTF-8}
output: 
  BiocStyle::html_document:
    toc_float: true
#  pdf_document:
#    toc: true   
vignette: >
    %\VignetteIndexEntry{Learn to use artMS ~30 min}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  eval=FALSE
)
```

artMS provides a set of tools for the analysis of proteomics 
label-free datasets. 

# Overview

The functions available at `artMS` can be grouped in 4 major categories:

1. Quality Control
1. Relative quantification with MSstats
1. Downstream analysis (relies on the output from 2)
1. Miscellaneous: a series of functions to do a little bit of everything.

The quality control can be run simultaneously as part of the **Relative Quantification** through the section `qc` of the configuration (`yaml`) file required to run it (see details below)

# Quality Control Analysis

**Standalone version for the Quality Control analysis of the MaxQuant evidence file**

Running a quality control of the evidence file requires two files:

- `evidence.txt` file obtain from MaxQuant
- `keys.txt`: a file describing the experimental design of the evidence file

As an example, we will use a phosphorylation dataset available to download from the [kroganlab website](http://kroganlab.ucsf.edu/)

```{r}
# Evidence file
url_evidence <- '~/experiments/artms/ph/evidence.txt'
# url_evidence <- 'http://kroganlab.ucsf.edu/artms/ph/evidence.txt'
# evidence.df <- read.delim(url_evidence, stringsAsFactors = F)


# Keys file
url_keys <- "~/experiments/artms/ph/keys.txt"
# url_keys <- "http://kroganlab.ucsf.edu/artms/ph/keys.txt"
# keys.df <- read.delim(url_keys, stringsAsFactors = F)
```

Then run `artms_evidenceQC()` and specify the type of phosphoproteomics experiment (argument `prot_exp = ph`) like this:

```{r}
artms_evidenceQC(evidence_file = url_evidence, keys_file = url_keys, prot_exp = 'ph')
```
Other proteomics experiments available are `ab` (protein abundance), `ub` (protein ubiquitination), and `apms` (Affinity Purification Mass Spectrometry)

This function will use the `-evidence.txt` file name as a template name to generate the output file names.

Check `artms_evidenceQC()` to find out more about this function. 

# Relative quantification with MSstats

The relative quantification is the core of this package. All the information required to run a relative quantification analysis using `MSstats` is provided as a configuration file (`.yaml` format). Check the [README.md](../README.md) to find out more about the different sections of the configuration file. A template of the configuration file is available [here](../data-raw/artms_config.yaml).

4 main options must be specified by the user:

- `evidence.txt` file location
- `keys.txt` file location
- `contrast.txt` file location, specifying the comparisons to be performed
- `results/results.txt` specified the file location and root name for the results files.

Different types of proteomics experiments can be analyzed, including protein abundance, affinity purification mass spectrometry (APMS), and different type of posttranslational modifications, including phosphorylation (ph), ubiquitination (ub), and acetylation (ac)

## Quantification of Changes in Global Phosphorylation

The **global phosphorylation** quantification analysis calculates changes in phosphorylation at the *protein level*. This means that all the **modified** peptides are used to quantify changes in protein phosphorylation. The **site-specific** quantification (explained next) quantifies changes at the *peptide level*, i.e., each modified peptide independently. 

Only two sections need to be modified on the **default** configuration (`yaml`) file:

```{yaml}
files:
  evidence : /path/to/the/evidence.txt
  keys : /path/to/the/keys.txt
  contrasts : /path/to/the/contrast.txt
  output : /path/to/the/output/results/results.txt
  .
  .
  .
data:
  .
  .
  .
  filters:
    modifications : PH
```

The remaining options can be left unmodified. 

Once the configuration `yaml` file is ready, run the following command:

```{r}
artms_main(yaml_config_file = '/path/to/config/file/artms_phglobal_config.yaml')
```

## Quantification of Changes in Site-Specific Phosphorylation

The `site-specific` analysis quantifies changes at the modified peptide level. This means that changes in every modified (ph) peptide of a given protein will be quantified individually. The caveat is that the proportion of missing values should increase relative to the **global** analysis. Both **site** and **global** ph analysis are highly correlated due to the fact that only one or two peptides drive the overall changes in phosphorylation for every protein.

To run the 

1. A pre-processing step is required to be run on the evidence file to enable the site-specific ph analysis. 

```{r}
artms_proteinToSiteConversion(evidence_file = "/path/to/the/evidence.txt", ref_proteome_file = "/path/to/the/reference_proteome.fasta", output_file = "/path/to/the/output/ph-sites-evidence.txt", mod_type = "PH")
```

2. Generate a new configuration file (`phsites_config.yaml`) as explained above, but use the "new" `/path/to/the/output/ph-sites-evidence.txt` file instead of the original `evidence.txt` file.

Once the new `yaml` file has been created, execute:

```{r}
artms_main(yaml_config_file = '/path/to/config/file/phsites_config.yaml')
```




